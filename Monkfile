#make a few plots relevant to motion ehergy
--command Rscript
--input motion_energy_plot.R
--input --match motion_energy\.csv
--output motion_energy.pdf

#type "make figures" to try to refresh the figures
#--command --input --invisible --match '.*\.fig$'
#--output --invisible --phony figures

#matlab stuff requires we unpack all the data into a matlab file.
--command --once runmatlab --once unpack
--input --invisible --once unpack.m
--input --match (.*_trials\.csv)$
--output --invisible --once data.mat

#might as well unpack into an R data file.
--command --once Rscript
--input --once --invisible unpack.R
--output --once data.RData
--input --match --invisible (.*_trials\.csv) {0}

#the model-fitting function
#--command ./runmatlab MeilstrupBoyntonModel
#--input --invisible MeilstrupBoyntonModel.m
#--input --invisible --match data\.mat"
#--output --invisible modelResults.mat


#fit all the models
--command ./runmatlab --once "fitAll"
--input --invisible fitAll.m
--input --match data\.mat
--output fits.mat

#plot all the fits
#
--command --once ./runmatlab --once plotFits
--input --invisible plotFits.m
--input --match fits\.mat
--output --listing --intermediate fit_plots.list

#bundle them all into a multipage PDF
--command --once pdfjoin
--once %--outfile
--once --output fits_{0}.pdf
--input --match fit_(.*)_.*\.pdf$
--invisible --phony --once figures

#make diagnostic figures? #WHY_IS_THIS_ALWAYS_RUNNING
# --command ./runmatlab "makeDiagnostics"
# --input --match 'fits\.mat'
# --output --listing 'diagnosticPlots.pdf'
# --invisible --phony --once figures

#and bundle them #these are outputs of makeDiagnostics
# --command --once pdfjoin
# --once %--outfile
# --once --output 'residuals_{0}_plots.pdf'
# --input --match 'residual_(.*)_.*\.pdf$'
# --invisible --phony --once --output figures

#make our motion energy graphs
--command Rscript
--input motion_energy_plot.R
--input --match motion_energy.csv
--output --listing --mkdir energy/motion_energy_plot.list

--command Rscript
--input slopeModel.R
--input --match data.RData
--input motion_energy.csv
--output slopeModel.RData
--output slopeModel.pdf

--command Rscript
--input density.calibration.R
--input --match data.RData
--input slopeModel.RData
--output density.calibration.pdf

--command Rscript
--input --match density.modeling.R
--input data.RData
--input slopeModel.RData
--output density.modeling.pdf
--output density.modeling.detail.pdf
--output density.modeling.RData

--command Rscript
--input combined.model.R
--input --match slopeModel\.RData
--input density.modeling.RData
--input motion_energy.csv
--output combined.model.RData
--output combined.model.pdf

--command Rscript
--input contours.R
--input --match slopeModel\.RData
--input motion_energy.csv
--output --mkdir --listing contours/contours.list FALSE

--command Rscript
--input contours.R
--input --match slopeModel.RData
--input motion_energy.csv
--output --mkdir --listing contours/contours_folded.list
TRUE # with folding

##this don't work: it multiply generates contours.list
#--command --once pdfjoin
#--once --output contours/all_contours.pdf
#--input --listing --match contours/contours.list

##this also don't work: it doesn't match
#--command --once pdfjoin
#--input --match contours/contours.*\.pdf
#--once --output contours/all_contours.pdf

--command pdfjoin %--rotateoversize 'false'
%--outfile --output contours/all_contours.pdf
--input --match --listing contours/contours.list

--command pdfjoin %--rotateoversize 'false'
%--outfile --output contours/all_contours_folded.pdf
--input --match --listing contours/contours_folded.list

--command --invisible --input --match .*\.pdf
--output --phony --invisible --once pdf
