#gather up all .csv files except those already gathered.
--command cp 
--input --match '.*(?<!modeling)/([^/]*)\.csv$' 
--output 'modeling/{0}.csv'

#gather raw trial data and put them in CSV files
--command            Rscript 
--input              make_csv.R
--input --match      'collections/(.*)\.list'
		     discrimination.sqlite
--input --invisible  discrimination.sqlite.DONE
--output             modeling/{0}_trials.csv

#plot threshold values
--command            --once ./runmatlab 
--input --invisible  modeling/plotThresholds.m
--once               "\"addpath('modeling');\" plotThresholds"
--input --match      'modeling/.*_series_calculations.csv'
--output --invisible modeling/plotThresholds.fig

#type "make figures" to try to refresh the figures
--command --input --invisible --match '.*\.fig$'
--output --invisible --phony figures

#matlab stuff requires we unpack all the data into a matlab file.
--command --once ./runmatlab --once "\"cd('modeling');\" unpack"
--input --invisible --once modeling/unpack.m
--input --match modeling/(.*_trials\.csv)$
--output --invisible --once modeling/data.mat

#might as well unpack into an R data file.
--command --once Rscript --once --input modeling/unpack.R
--input --invisible modeling/unpack.R
--output --once modeling/data.Rd
--input --match modeling/(.*_trials\.csv)

#the model-fitting function
--command ./runmatlab "\"cd('modeling'); MeilstrupBoyntonModel\""
--input --invisible --match "modeling/data\.mat"
--input --invisible modeling/MeilstrupBoyntonModel.m
--output --invisible modeling/modelResults.mat

#and let's start translating this to R also.
--command --once Rscript --input modeling/MeilstrupBoyntonModel.R
--input --match 'modeling/data\.Rd'
--output --once modeling/result.Rd
--output --invisible modeling/modelResults.mat

#fit all the models
--command ./runmatlab --once "\"cd('modeling'); fitAll\""
--input --invisible modeling/fitAll.m
--input --match 'modeling/data\.mat'
--output 'modeling/fits.mat'

#make raw fit figures?


#make diagnostic figures?